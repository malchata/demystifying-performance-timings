<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="robots" content="noindex, nofollow, nocache">
    <title>Demystifying Performance Timings</title>
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/mystifying.css">
    <link rel="stylesheet" href="lib/css/zenburn.css">
  </head>
  <body>
    <a class="twitter" href="https://twitter.com/malchata" rel="noopener">@malchata</a>
    <!--
      // TODO: Add ToC later
    -->
    <div class="reveal">
      <div class="slides">
        <!-- [0.0] - Intro -->
        <section>
          <!-- [0.1] - Title Card -->
          <section data-state="title-card">
            <div class="title-container">
              <h1 class="accent">Demystifying</h1>
              <h2>Performance timings</h2>
              <h5>&nbsp;</h5>
              <h5 class="lowercase"><em>by Jeremy Wagner &mdash; <a href="https://twitter.com/malchata" rel="noopener">@malchata</a> &mdash; <a href="https://jeremywagner.me/" rel="noopener">jeremywagner.me</a></em></h5>
            </div>
          </section>
        </section>
        <!-- [1.0] -->
        <section>
          <!-- [1.1] -->
          <section data-state="section-slide">
            <h1 class="accent">In regards to</h1>
            <h2>measuring perf</h2>
          </section>
          <!-- [1.2] -->
          <section data-state="centered">
            <h1>Synthetic testing</h1>
            <h2 class="lowercase fragment">(or <em>lab data</em>)</h2>
          </section>
          <!-- [1.3] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/lighthouse-2x.webp 2x, img/lighthouse-1x.webp 1x" type="image/webp">
              <source srcset="img/lighthouse-2x.png 2x, img/lighthouse-1x.png 1x" type="image/png">
              <img src="img/lighthouse-2x.png" alt="A screenshot of Chrome's Lighthouse audit in action.">
            </picture>
            <h4 class="lowercase"><em>Lighthouse</em></h4>
          </section>
          <!-- [1.4] -->
          <section>
            <h1 class="accent">The case for:</h1>
            <ul>
              <li class="fragment">It's <em>easy to do</em>.</li>
              <li class="fragment">Great for spot checking performance in dev environments. <span class="fragment">(With network throttling, of course.)</span></li>
              <li class="fragment">Easy to measure the effect of code changes on performance due to consistent baselines.</li>
            </ul>
          </section>
          <!-- [1.5] -->
          <section>
            <h1 class="accent">The case against:</h1>
            <h3 class="lowercase fragment">It doesn't necessarily reflect what <em>real users</em> are <em>experiencing</em>.</h3>
          </section>
          <!-- [1.6] -->
          <section data-state="centered">
            <h1>Enter RUM</h1>
          </section>
          <!-- [1.7] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/cheap-rum.webp" type="image/webp">
              <img src="img/cheap-rum.png" alt="A bottle of cheap rum.">
            </picture>
            <h3 class="lowercase fragment">(No, not <em>this</em>.)</h3>
          </section>
          <!-- [1.8] -->
          <section data-state="centered">
            <h1><u>R</u>eal <u>U</u>ser <u>M</u>etrics</h1>
            <h2 class="lowercase fragment">(or <em>field data</em>)</h2>
          </section>
          <!-- [1.9] -->
          <section>
            <h1 class="accent">The case for:</h1>
            <h3 class="lowercase fragment">You're gathering metrics from <em>real users</em> who are using your site/app.</h3>
          </section>
          <!-- [1.10] -->
          <section>
            <h1 class="accent">The case against:</h1>
            <h3 class="lowercase fragment">It's not as convenient.</h3>
          </section>
          <!-- [1.11] -->
          <section>
            <pre><code class="javascript">performance.getEntriesByType("navigation").forEach((navigation)=>{
  console.dir(navigation);
});</code></pre>
          </section>
          <!-- [1.12] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/navigation-timing-2x.webp 2x, img/navigation-timing-1x.webp 1x" type="image/webp">
              <source srcset="img/navigation-timing-2x.png 2x, img/navigation-timing-1x.png 1x" type="image/png">
              <img src="img/navigation-timing-2x.png" alt="A screenshot of a navigation timing entry in Chrome.">
            </picture>
          </section>
          <!-- [1.13] -->
          <section data-state="centered despair">
            <video muted id="despair" class="stretch">
              <source src="video/despair.webm" type="video/webm">
              <source src="video/despair.ogv" type="video/ogg">
              <source src="video/despair.mp4" type="video/mp4">
            </video>
          </section>
        </section>
        <!-- [2.0] -->
        <section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Navigation</h2>
            <h3 class="lowercase"><em>and</em></h3>
            <h2>Resource Timing</h2>
          </section>
          <!-- [2.] -->
          <section>
            <h1 class="accent">Navigation timing</h1>
            <h3>Gathers page metrics.</h3>
            <h4 class="fragment lowercase"><em>(Usually HTML documents.)</em></h4>
          </section>
          <!-- [2.] -->
          <section>
            <h1 class="accent">Resource timing</h1>
            <h3>Gathers resource metrics.</h3>
            <h4 class="fragment lowercase"><em>(CSS, JavaScript, images, et cetera.)</em></h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Processing Model</h2>
            <img class="stretch" src="img/nav-timing-processing-model.svg" alt="Navigation timing processing model diagram.">
            <h5 class="lowercase"><a href="https://www.w3.org/TR/navigation-timing-2/#processing-model" rel="noopener">w3.org/TR/navigation-timing-2/#processing-model</a></h5>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Unload</h2>
            <h4 class="lowercase">When the document unloads. Triggered any time a navigation (successfully) kicks off.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Unload</h3>
            <img src="img/nav-timing-unload.svg" alt="Navigation timing processing model diagram with the unload phase highlighted.">
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h2>unload metrics</h2>
            <ul>
              <li class="fragment"><code>startTime</code> is always <code>0</code>.</li>
              <li class="fragment"><code>unloadEventStart</code> is <em>not</em> always <code>0</code>.</li>
              <li class="fragment"><code>unloadEventStart</code> and <code>unloadEventEnd</code> can overlap with other events (e.g., connect, redirect).</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Redirect</h2>
            <h4 class="lowercase">When a navigation encounters one (or more) 3xx level status codes, causing redirection.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>You should care</h3>
            <picture>
              <source srcset="img/redirect-2x.webp 2x, img/redirect-1x.webp 1x" type="image/webp">
              <source srcset="img/redirect-2x.png 2x, img/redirect-1x.png 1x" type="image/png">
              <img class="stretch" src="img/redirect-2x.png" alt="A screenshot of redirects mapped out in Chrome dev tools.">
            </picture>
            <h3>about redirects</h3>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Redirect*</h3>
            <img src="img/nav-timing-redirect.svg" alt="Navigation timing processing model diagram with the redirect phase highlighted.">
            <h5 class="fragment lowercase"><em>*Resource timing API processing model <u>begins</u> here.</em></h5>
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>Redirect metrics</h3>
            <ul>
              <li class="fragment"><code>redirectStart</code> and <code>redirectEnd</code> will be <code>0</code> if no redirects occur.</li>
              <li class="fragment">Redirects from and to other origins can still come up as <code>0</code> if the <code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Timing-Allow-Origin" rel="noopener">Timing-Allow-Origin</a></code> header isn't set.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>App Cache</h2>
            <h4 class="lowercase">A phase where the browser may fetch items from a cache (including HTTP cache).</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>App Cache</h3>
            <img src="img/nav-timing-appcache.svg" alt="Navigation timing processing model diagram with the app cache phase highlighted.">
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>App Cache metrics</h3>
            <ul>
              <li class="fragment">Regardless of caching, <code>fetchStart</code> begins about the same time (varying baselines notwithstanding).</li>
              <li class="fragment">If an item is cached, metrics that come after <code>fetchStart</code> (e.g., <code>connectStart</code>, et cetera) will occur very nearly after.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Cached <span class="lowercase">vs.</span> uncached</h2>
            <img class="stretch" src="img/appcache-differences.svg" alt="Differences in app cache performance timing phases for cached and uncached resources.">
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>DNS</h2>
            <h4 class="lowercase">When DNS lookups occur.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>DNS</h3>
            <img src="img/nav-timing-dns.svg" alt="Navigation timing processing model diagram with the DNS phase highlighted.">
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>DNS metrics</h3>
            <ul>
              <li class="fragment">DNS lookups happen once per origin per session.</li>
              <li class="fragment">DNS lookups can be cached at multiple levels.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Connection</h2>
            <h4 class="lowercase">When connections are established.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Connection</h3>
            <img src="img/nav-timing-tcp.svg" alt="Navigation timing processing model diagram with the TCP phase highlighted.">
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>Connection metrics</h3>
            <ul>
              <li class="fragment">Connection setup happens once per origin per session.</li>
              <li class="fragment"><code>secureConnectionStart</code> only happens on HTTPS.</li>
              <li class="fragment"><code>secureConnectionStart</code> can be <code>0</code> if TLS sessions are resumed.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Request/Response</h2>
            <h4 class="lowercase">When requests are made, and when responses begin and end.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Request/Response*</h3>
            <img src="img/nav-timing-request-response.svg" alt="Navigation timing processing model diagram with the request and response phases highlighted.">
            <h5 class="fragment lowercase"><em>*Resource timing API processing model <u>ends</u> here.</em></h5>
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>Request/Response metrics</h3>
            <ul>
              <li class="fragment"><code>requestStart</code> denotes the start of a request.</li>
              <li class="fragment"><code>responseStart</code> and <code>responseEnd</code> denote the start and end of a response, respectively.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Requests/Responses</h3>
            <picture>
              <source srcset="img/request-response-2x.webp 2x, img/request-response-1x.webp 1x" type="image/webp">
              <source srcset="img/request-response-2x.png 2x, img/request-response-1x.png 1x" type="image/png">
              <img class="stretch" src="img/request-response-2x.png" alt="A screenshot of request and response metrics mapped out in Chrome dev tools.">
            </picture>
            <h2>visualized</h2>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Processing</h2>
            <h4 class="lowercase">When the DOM is being processed, including when the DOM is interactive and when processing starts/begins.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Processing</h3>
            <img src="img/nav-timing-processing.svg" alt="Navigation timing processing model diagram with the processing phase highlighted.">
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>Processing metrics</h3>
            <ul>
              <li class="fragment"><code>domInteractive</code> marks when the browser has finished HTML parsing and DOM construction.</li>
              <li class="fragment"><code>domContentLoadedEventStart</code> and <code>domContentLoadedEventEnd</code> marks when the DOM is ready.</li>
              <li class="fragment"><code>domComplete</code> marks when everything has loaded.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>Processing metrics (Cont'd)</h3>
            <ul>
              <li class="fragment"><code>domInteractive</code>, <code>domContentLoadedEventStart</code>, and <code>domContentLoadedEventEnd</code> occur around the same time.</li>
              <li class="fragment">Depending on front end architecture complexity, <code>domComplete</code> often occurs some time after <code>domContentLoadedEventEnd</code>.</li>
            </ul>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/dom-metrics-2x.webp 2x, img/dom-metrics-1x.webp 1x" type="image/webp">
              <source srcset="img/dom-metrics-2x.png 2x, img/dom-metrics-1x.png 1x" type="image/png">
              <img class="stretch" src="img/dom-metrics-2x.png" alt="A screenshot of redirects mapped out in Chrome dev tools.">
            </picture>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h2>Load</h2>
            <h4 class="lowercase">When the page and all of its resources are fully loaded.</h4>
          </section>
          <!-- [2.] -->
          <section data-state="centered">
            <h3>Load</h3>
            <img src="img/nav-timing-load.svg" alt="Navigation timing processing model diagram with the load phase highlighted.">
          </section>
          <!-- [2.] -->
          <section>
            <h2 class="accent">Regarding</h2>
            <h3>Load metrics</h3>
            <ul>
              <li class="fragment"><code>loadEventStart</code> usually occurs briefly after <code>domComplete</code>.</li>
              <li class="fragment"><code>loadEventEnd</code> signifies when the page has <em>completely</em> finished loading.</li>
            </ul>
          </section>
        </section>
        <!-- [3.0] -->
        <section>
          <!-- [3.] -->
          <section>
            <h1 class="accent">The little bits!</h1>
            <h3 class="lowercase"><em>(Or, metrics that don't fit on a timeline.)</em></h3>
          </section>
          <!-- [3.] -->
          <section data-state="centered">
            <h2><code>transferSize</code></h2>
            <h3 class="lowercase">The size of a resource including headers.</h3>
          </section>
          <!-- [3.] -->
          <section data-state="centered">
            <picture>
              <source srcset="/img/http-headers.webp" type="image/webp">
              <img src="/img/http-headers.png" alt="An image of HTTP response headers.">
            </picture>
          </section>
          <!-- [3.] -->
          <section data-state="centered">
            <h2><code>encodedBodySize</code></h2>
            <h3 class="lowercase">The compressed size of a resource.</h3>
            <h4 class="lowercase"><em>(Without headers.)</em></h4>
          </section>
          <!-- [3.] -->
          <section data-state="centered">
            <h2><code>decodedBodySize</code></h2>
            <h3 class="lowercase">The decompressed size of a resource.</h3>
            <h4 class="lowercase"><em>(Without headers.)</em></h4>
          </section>
          <!-- [3.] -->
          <section data-state="centered">
            <h2><code>nextHopProtocol</code></h2>
            <h3 class="lowercase">The protocol used to transmit a resource.</h3>
          </section>
          <!-- [3.] -->
          <section>
            <h3><code>nextHopProtocol</code> values*:</h3>
            <ul>
              <li class="fragment"><code>h2</code> (HTTP/2)</li>
              <li class="fragment"><code>hq</code> (QUIC)</li>
              <li class="fragment"><code>http/1.1</code></li>
            </ul>
            <h4 class="fragment lowercase"><em>*This is probably not exhaustive!</em></h4>
          </section>
        </section>
        <!-- [4.0] -->
        <section>
          <!-- [4.] -->
          <section>
            <h1 class="accent">Timing recipes!</h1>
          </section>
          <!-- [4.] -->
          <section data-state="centered">
            <h2>Resource fetch time</h2>
            <h3><code>responseEnd - fetchStart</code></h3>
          </section>
          <!-- [4.] -->
          <section data-state="centered">
            <h2>Resource fetch speed</h2>
            <h4><code>((transferSize / (2^20) / ((responseEnd - responseStart) / 1000)) * 8</code></h4>
          </section>
          <!-- [4.] -->
          <section data-state="centered">
            <h2>Compression ratio</h2>
            <h4><code>decodedBodySize / encodedBodySize</code></h4>
          </section>
          <!-- [4.] -->
          <section data-state="centered">
            <h2>HTTP header size</h2>
            <h4><code>transferSize - encodedBodySize</code></h4>
          </section>
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      Reveal.initialize({
        history: true,
        controls: false,
        transition: "none",
        progress: false,
        viewDistance: 2,
        help: false,
        dependencies: [{
            src: 'plugin/notes/notes.js',
            async: true
          },
          {
            src: 'plugin/highlight/highlight.js',
            async: true,
            callback: function(){
              hljs.initHighlightingOnLoad();
            }
          }
        ]});

        Reveal.addEventListener("despair", function(){
          document.getElementById("despair").play();
        });
    </script>
    <script src="js/jquery.js"></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="robots" content="noindex, nofollow, nocache">
    <title>Demystifying Performance Timings</title>
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/mystifying.css?v=3">
    <link rel="stylesheet" href="lib/css/zenburn.css">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <!-- [0.0] - Intro -->
        <section>
          <!-- [0.1] - Title Card -->
          <section data-state="title-card">
            <div class="title-container">
              <h1 class="accent">Demystifying</h1>
              <h2>Performance timings</h2>
              <hr>
              <h4 class="lowercase"><em>by Jeremy Wagner &mdash; <a href="https://twitter.com/malchata" rel="noopener">@malchata</a> &mdash; <a href="https://jeremywagner.me/" rel="noopener">jeremywagner.me</a></em></h4>
            </div>
          </section>
          <!-- [0.2] - Hello! -->
          <section>
            <div class="flex-item-container">
              <div>
                <h1 class="accent">Hello,</h1>
                <h3 class="lowercase">I'm Jeremy!</h3>
              </div>
              <img src="img/me.jpg" alt="Jeremy Wagner speaking at a conference.">
            </div>
          </section>
        </section>
        <!-- [1.0] -->
        <section>
          <!-- [1.1] -->
          <section data-state="section-slide">
            <h1 class="accent">Regarding</h1>
            <h2>Testing methods</h2>
          </section>
          <!-- [1.2] -->
          <section data-state="centered">
            <h1>Synthetic testing</h1>
            <h3 class="lowercase fragment">(or <em>lab data</em>)</h3>
          </section>
          <!-- [1.3] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/lighthouse-2x.webp 2x, img/lighthouse-1x.webp 1x" type="image/webp">
              <source srcset="img/lighthouse-2x.png 2x, img/lighthouse-1x.png 1x" type="image/png">
              <img src="img/lighthouse-2x.png" alt="A screenshot of Chrome's Lighthouse audit in action.">
            </picture>
            <h4 class="lowercase"><em>Lighthouse</em></h4>
          </section>
          <!-- [1.4] -->
          <section data-state="centered">
            <img src="img/appd.svg" class="medium" alt="AppDynamics Logo">
            <picture>
              <source srcset="img/appd-synthetic-test-2x.webp 2x, img/appd-synthetic-test-1x.webp 1x" type="image/webp">
              <source srcset="img/appd-synthetic-test-2x.png 2x, img/appd-synthetic-test-1x.png 1x" type="image/png">
              <img src="img/appd-synthetic-test-2x.png" alt="A screenshot of synthetic snapshot in APM.">
            </picture>
            <h4 class="lowercase"><em>Synthetic Snapshot</em></h4>
          </section>
          <!-- [1.5] -->
          <section>
            <h1 class="accent">The case for:</h1>
            <ul>
              <li class="fragment">Great for testing performance in local dev environments. <span class="fragment">(With network throttling, of course.)</span></li>
              <li class="fragment">Easy to measure the effect of code changes on performance.</li>
            </ul>
          </section>
          <!-- [1.6] -->
          <section>
            <h1 class="accent">The problem:</h1>
            <h3 class="lowercase fragment">It doesn't reflect what <em>real users</em> are experiencing.</h3>
          </section>
          <!-- [1.7] -->
          <section data-state="centered">
            <h3>Enter</h3>
            <h2><u>R</u>eal <u>U</u>ser <u>M</u>onitoring</h2>
            <h3 class="lowercase fragment">(or <em>field data</em>)</h3>
          </section>
          <!-- [1.8] -->
          <section>
            <h1 class="accent">What RUM solves:</h1>
            <h3 class="lowercase fragment">RUM gathers non-synthetic metrics.</h3>
          </section>
          <!-- [1.9] -->
          <section>
            <h1 class="accent">The problem:</h1>
            <h3 class="lowercase fragment">It's <em>hard to do</em>.</h3>
          </section>
          <!-- [1.10] -->
          <section>
            <pre><code class="javascript">// Doesn't look _that_ hard, right?
performance.getEntriesByType("navigation");</code></pre>
          </section>
          <!-- [1.11] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/navigation-timing-2x.webp 2x, img/navigation-timing-1x.webp 1x" type="image/webp">
              <source srcset="img/navigation-timing-2x.png 2x, img/navigation-timing-1x.png 1x" type="image/png">
              <img src="img/navigation-timing-2x.png" alt="A screenshot of a navigation timing entry in Chrome.">
            </picture>
          </section>
          <!-- [1.12] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/cry.webp" type="image/webp">
              <img class="stretch" src="img/cry.gif" alt="An animated GIF of a Michael Scott straining to hold back tears.">
            </picture>
            <h4>Gaze upon thy works and despair.</h4>
          </section>
          <!-- [1.13] -->
          <section data-state="centered">
            <h3 class="lowercase"><em>If it is so hard to do,</em></h3>
            <h2>Then why do it?</h2>
          </section>
        </section>
        <!-- [2.0] -->
        <section>
          <!-- [2.1] -->
          <section data-state="centered">
            <h1 class="accent">Navigation</h1>
            <h2 class="accent">and</h2>
            <h1 class="accent">Resource Timing</h1>
          </section>
          <!-- [2.2] -->
          <section>
            <h1 class="accent">Navigation timing</h1>
            <h3>Gathers page metrics.</h3>
          </section>
          <!-- [2.3] -->
          <section>
            <h1 class="accent">Resource timing</h1>
            <h3>Gathers resource metrics.</h3>
          </section>
          <!-- [2.4] -->
          <section data-state="centered">
            <h2>Processing Model</h2>
            <img class="stretch" src="img/nav-timing-processing-model.svg" alt="Navigation timing processing model diagram.">
            <h5 class="lowercase"><em><a href="https://www.w3.org/TR/navigation-timing-2/#processing-model" rel="noopener">w3.org/TR/navigation-timing-2/#processing-model</a></em></h5>
          </section>
          <!-- [2.5] -->
          <section data-state="centered">
            <h2>Unload Phase</h2>
            <h4 class="lowercase">When the document unloads.</h4>
          </section>
          <!-- [2.6] -->
          <section data-state="centered">
            <h3>Unload Phase</h3>
            <img src="img/nav-timing-unload.svg" alt="Navigation timing processing model diagram with the unload phase highlighted.">
          </section>
          <!-- [2.7] -->
          <section>
            <h1 class="accent">RUM Trivia:</h1>
            <ul>
              <li><code>startTime</code> is always <code>0</code> for the current document.</li>
              <li class="fragment"><code>startTime</code> is greater than <code>0</code> for resources.</li>
              <li class="fragment"><code>unloadEventStart</code> may be <code>0</code> if there is no previous document to unload (i.e., <code>about:blank</code>).</li>
            </ul>
          </section>
          <!-- [2.8] -->
          <section data-state="centered">
            <h2>Redirect Phase</h2>
            <h4 class="lowercase">When a navigation encounters one (or more) HTTP 300 level status codes.</h4>
          </section>
          <!-- [2.9] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/redirect-2x.webp 2x, img/redirect-1x.webp 1x" type="image/webp">
              <source srcset="img/redirect-2x.png 2x, img/redirect-1x.png 1x" type="image/png">
              <img class="stretch" src="img/redirect-2x.png" alt="A screenshot of redirects mapped out in Chrome dev tools.">
            </picture>
          </section>
          <!-- [2.10] -->
          <section data-state="centered">
            <h3>Redirect Phase</h3>
            <img src="img/nav-timing-redirect.svg" alt="Navigation timing processing model diagram with the redirect phase highlighted.">
            <h5 class="fragment lowercase"><em>Resource timing API processing model <u>begins</u> here.</em></h5>
          </section>
          <!-- [2.11] -->
          <section data-state="centered">
            <h2>Cache Seek Phase</h2>
            <h4 class="lowercase">When the browser begins to fetch an item.</h4>
          </section>
          <!-- [2.12] -->
          <section data-state="centered">
            <h3>Cache Seek Phase</h3>
            <img src="img/nav-timing-cache.svg" alt="Navigation timing processing model diagram with the cache phase highlighted.">
          </section>
          <!-- [2.13] -->
          <section data-state="centered">
            <h3>Cached <span class="lowercase">vs.</span> uncached</h3>
            <img class="stretch" src="img/appcache-differences.svg" alt="Differences in app cache performance timing phases for cached and uncached resources.">
          </section>
          <!-- [2.14] -->
          <section data-state="centered">
            <h2>DNS</h2>
            <h4 class="lowercase">When domain lookups occur.</h4>
          </section>
          <!-- [2.15] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/connection-time-2x.webp 2x, img/connection-time-1x.webp 1x" type="image/webp">
              <source srcset="img/connection-time-2x.png 2x, img/connection-time-1x.png 1x" type="image/png">
              <img class="larger stretch" src="img/connection-time-2x.png" alt="A screenshot of connection phases and times for a page resource in Chrome dev tools.">
            </picture>
          </section>
          <!-- [2.16] -->
          <section data-state="centered">
            <h3>DNS</h3>
            <img src="img/nav-timing-dns.svg" alt="Navigation timing processing model diagram with the DNS phase highlighted.">
          </section>
          <!-- [2.17] -->
          <section>
            <h1 class="accent">RUM Trivia:</h1>
            <ul>
              <li class="fragment">
                DNS lookups can be cached at multiple levels:<br>
                <ul>
                  <li class="fragment">Browser (<code>chrome://net-internals#dns</code>).</li>
                  <li class="fragment">System.</li>
                  <li class="fragment">Router.</li>
                  <li class="fragment"><em>Beyond</em>.</li>
                </ul>
              </li>
            </ul>
          </section>
          <!-- [2.18] -->
          <section data-state="centered">
            <h2>Connection Phase</h2>
            <h4 class="lowercase">When connections are established.</h4>
          </section>
          <!-- [2.19] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/connection-time-2x.webp 2x, img/connection-time-1x.webp 1x" type="image/webp">
              <source srcset="img/connection-time-2x.png 2x, img/connection-time-1x.png 1x" type="image/png">
              <img class="larger" src="img/connection-time-2x.png" alt="A screenshot of connection phases and times for a page resource in Chrome dev tools.">
            </picture>
          </section>
          <!-- [2.20] -->
          <section data-state="centered">
            <h3>Connection Phase</h3>
            <img src="img/nav-timing-tcp.svg" alt="Navigation timing processing model diagram with the TCP phase highlighted.">
          </section>
          <!-- [2.21] -->
          <section>
            <h1 class="accent">RUM Trivia:</h1>
            <ul>
              <li class="fragment">Connections can be resumed (i.e., <code>Keep-Alive</code>).</li>
              <li class="fragment"><code>secureConnectionStart</code> will be <code>0</code> for non-secure sites <span class="fragment"><em>or</em> if TLS sessions are resumed.</span></li>
            </ul>
          </section>
          <!-- [2.22] -->
          <section data-state="centered">
            <h2>Request/Response Phase</h2>
            <h4 class="lowercase">When requests are made, and when responses begin/end.</h4>
          </section>
          <!-- [2.23] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/request-response-2x.webp 2x, img/request-response-1x.webp 1x" type="image/webp">
              <source srcset="img/request-response-2x.png 2x, img/request-response-1x.png 1x" type="image/png">
              <img class="larger" src="img/request-response-2x.png" alt="A screenshot of request and response metrics mapped out in Chrome dev tools.">
            </picture>
          </section>
          <!-- [2.24] -->
          <section data-state="centered">
            <h3>Request/Response Phase</h3>
            <img src="img/nav-timing-request-response.svg" alt="Navigation timing processing model diagram with the request and response phases highlighted.">
            <h5 class="fragment lowercase"><em>*Resource timing API processing model <u>ends</u> here.</em></h5>
          </section>
          <!-- [2.25] -->
          <section data-state="centered">
            <h2>Processing Phase</h2>
            <h4 class="lowercase">When the DOM is being processed.</h4>
          </section>
          <!-- [2.26] -->
          <section data-state="centered">
            <h3>Processing Phase</h3>
            <img src="img/nav-timing-processing.svg" alt="Navigation timing processing model diagram with the processing phase highlighted.">
          </section>
          <!-- [2.27] -->
          <section>
            <h1 class="accent">RUM Trivia:</h1>
            <ul>
              <li class="fragment"><code>domInteractive</code> marks when the browser has finished DOM construction.</li>
              <li class="fragment"><code>domContentLoadedEventEnd</code> marks when the DOM is ready.</li>
              <li class="fragment"><code>domComplete</code> marks when everything has loaded.</li>
            </ul>
          </section>
          <!-- [2.28] -->
          <section data-state="centered">
            <h2>Load Phase</h2>
            <h4 class="lowercase">When the page and all of its resources are fully loaded.</h4>
          </section>
          <!-- [2.29] -->
          <section data-state="centered">
            <h3>Load Phase</h3>
            <img src="img/nav-timing-load.svg" alt="Navigation timing processing model diagram with the load phase highlighted.">
          </section>
        </section>
        <!-- [3.0] -->
        <section>
          <!-- [3.1] -->
          <section>
            <h1 class="accent">The little bits!</h1>
          </section>
          <!-- [3.2] -->
          <section data-state="centered">
            <h2><code>name</code></h2>
            <h3 class="lowercase">The URL of a document or resource.</h3>
          </section>
          <!-- [3.3] -->
          <section data-state="centered">
            <h2><code>transferSize</code></h2>
            <h3 class="lowercase">The size of a resource including headers.</h3>
          </section>
          <!-- [3.4] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/http-headers.webp" type="image/webp">
              <img src="img/http-headers.png" alt="An image of HTTP response headers.">
            </picture>
          </section>
          <!-- [3.5] -->
          <section data-state="centered">
            <h2><code>encodedBodySize</code></h2>
            <h3 class="lowercase">The compressed size of a resource.</h3>
            <h4 class="lowercase"><em>(Without headers.)</em></h4>
          </section>
          <!-- [3.6] -->
          <section data-state="centered">
            <h2><code>decodedBodySize</code></h2>
            <h3 class="lowercase">The decompressed size of a resource.</h3>
            <h4 class="lowercase"><em>(Again, without headers.)</em></h4>
          </section>
          <!-- [3.7] -->
          <section data-state="centered">
            <h2><code>nextHopProtocol</code></h2>
            <h3 class="lowercase">The protocol used to transmit a resource.</h3>
          </section>
          <!-- [3.8] -->
          <section>
            <h3><code>nextHopProtocol</code> values:</h3>
            <ul>
              <li class="fragment"><code>h2</code> (HTTP/2)</li>
              <li class="fragment"><code>hq</code> (QUIC)</li>
              <li class="fragment"><code>http/1.1</code></li>
            </ul>
          </section>
        </section>
        <!-- [4.0] -->
        <section>
          <!-- [4.1] -->
          <section>
            <h1 class="accent">Timing recipes!</h1>
          </section>
          <!-- [4.2] -->
          <section data-state="centered">
            <h2>TTFB <span class="lowercase"><em>(ms)</em></span></h2>
            <hr>
            <pre><code class="javascript">let ttfb = responseStart - fetchStart; // 35.6001 ms</code></pre>
          </section>
          <!-- [4.3] -->
          <section data-state="centered">
            <h2>Header size <span class="lowercase"><em>(bytes)</em></span></h2>
            <hr>
            <pre><code class="javascript">let headerSize = transferSize - encodedBodySize; // 169 bytes</code></pre>
          </section>
          <!-- [4.4] -->
          <section data-state="centered">
            <h2>DNS lookup time <span class="lowercase"><em>(ms)</em></span></h2>
            <hr>
            <pre><code class="javascript">let dnsTime = domainLookupEnd - domainLookupStart; // 171.2999 ms</code></pre>
          </section>
          <!-- [4.5] -->
          <section data-state="centered">
            <h2>TCP time <span class="lowercase"><em>(ms)</em></span></h2>
            <hr>
            <pre><code class="javascript">let tcpTime = connectEnd - connectStart; // 93.5005 ms</code></pre>
          </section>
          <!-- [4.6] -->
          <section data-state="centered">
            <h2>SSL time <span class="lowercase"><em>(ms)</em></span></h2>
            <hr>
            <pre><code class="javascript">let sslTime = 0;

if (secureConnectionStart &gt; 0) {
  sslTime = connectEnd - secureConnectionStart; // 58.6002 ms
}</code></pre>
          </section>
        </section>
        <!-- [5.0] -->
        <section>
          <!-- [5.1] -->
          <section>
            <h1 class="accent">Quick tips!</h1>
          </section>
          <!-- [5.2] -->
          <section data-state="centered">
            <h1>Don't use</h1>
            <h2><code>performance.timing</code></h2>
          </section>
          <!-- [5.3] -->
          <section>
            <h1 class="accent">The case against</h1>
            <h3><code>performance.timing</code></h3>
            <ul>
              <li class="fragment">Technically obsolete.</li>
              <li class="fragment">Uses low resolution Unix timestamps.</li>
            </ul>
          </section>
          <!-- [5.4] -->
          <section data-state="centered">
            <h2>
              Don't record<br>
              computed metrics
            </h2>
            <h4 class="fragment lowercase"><em>(Unless you know what you're doing.)</em></h4>
          </section>
          <!-- [5.5] -->
          <section data-state="centered">
            <h2>Always feature check:</h2>
            <pre><code class="javascript">// Check if we can do performance-y things
if (&quot;performance&quot; in window) {
  if (performance.getEntriesByType(&quot;navigation&quot;).length > 0) {
    // Do stuff with navigation timing
  }

  if (performance.getEntriesByType(&quot;resource&quot;).length > 0) {
    // Do stuff with resource timing
  }

  if (performance.getEntriesByType(&quot;paint&quot;).length > 0) {
    // Do stuff with paint timing
  }
}</code></pre>
          </section>
          <!-- [5.6] -->
          <section data-state="centered">
            <h3 class="lowercase">Gather performance metrics with</h3>
            <h2><code>PerformanceObserver</code></h2>
          </section>
          <!-- [5.7] -->
          <section data-state="centered">
            <h3>Using <code>PerformanceObserver</code></h3>
            <pre><code class="javascript">var observer = new PerformanceObserver(list => {
  var perfEntries = list.getEntries();

  for (let i = 0; i &lt; perfEntries.length; i++) {
    // Do stuff with whatever comes in
  }
});

observer.observe({
  // Add performance entry types you want to observe here:
  entryTypes: [&quot;navigation&quot;, &quot;resource&quot;, &quot;paint&quot;, &quot;longtask&quot;]
});</code></pre>
          </section>
        </section>
        <!-- [6.0] -->
        <section>
          <!-- [6.1] -->
          <section data-state="centered">
            <picture>
              <source srcset="img/understand-nothing.webp" type="image/webp">
              <img src="img/understand-nothing.png" alt="A picture of Michael Scott from The Office saying he doesn't understand anything.">
            </picture>
            <h2 class="accent">&quot;This is a <u>lot</u> to remember.&quot;</h2>
          </section>
          <!-- [6.2] -->
          <section data-state="centered">
            <img class="mediumish" src="img/appd.svg" alt="AppDynamics Logo">
            <h3>End User Monitoring</h3>
          </section>
          <!-- [6.3] -->
          <section data-state="centered">
            <h3>End User Monitoring</h3>
            <picture>
              <source srcset="img/appd-eum-overview-2x.webp 2x, img/appd-eum-overview-1x.webp 1x" type="image/webp">
              <img class="stretch" src="img/appd-eum-overview-1x.png" srcset="img/appd-eum-overview-2x.png 2x, img/appd-eum-overview-1x.png 1x" alt="An overview of metrics in the AppDynamics end-user monitoring product.">
            </picture>
            <h4 class="lowercase"><em>Get a high level view of real user performance.</em></h4>
          </section>
          <!-- [6.4] -->
          <section data-state="centered">
            <h3>End User Monitoring</h3>
            <picture>
              <source srcset="img/appd-timing-breakdown-2x.webp 2x, img/appd-timing-breakdown-1x.webp 1x" type="image/webp">
              <img class="stretch" src="img/appd-timing-breakdown-1x.png" srcset="img/appd-timing-breakdown-2x.png 2x, img/appd-timing-breakdown-1x.png 1x" alt="A breakdown of timings in the AppDynamics end-user monitoring product.">
            </picture>
            <h4 class="lowercase"><em>Visualize specific real user metrics.</em></h4>
          </section>
          <!-- [6.5] -->
          <section data-state="centered">
            <h3>End User Monitoring</h3>
            <picture>
              <source srcset="img/appd-low-level-2x.webp 2x, img/appd-low-level-1x.webp 1x" type="image/webp">
              <img class="stretch" src="img/appd-low-level-1x.png" srcset="img/appd-low-level-2x.png 2x, img/appd-low-level-1x.png 1x" alt="A low level view RUM data over time in the AppDynamics end-user monitoring product.">
            </picture>
            <h4 class="lowercase"><em>Plot low level timing data per category over time.</em></h4>
          </section>
          <section data-state="centered">
            <img class="mediumish" src="img/appd.svg" alt="AppDynamics Logo">
            <h3 class="lowercase"><em><a href="https://www.appdynamics.com/" rel="noopener">appdynamics.com</a></em></h3>
          </section>
        </section>
        <!-- [7.0] -->
        <section>
          <!-- [7.1] -->
          <section data-state="centered">
            <h1 class="accent">Thanks!</h1>
            <h3 class="lowercase">
              <em>
                Slides:<br>
                <a href="https://jlwagner.net/talks/perf-timings-appd" rel="noopener">jlwagner.net/talks/perf-timings-appd</a>
              </em>
            </h3>
          </section>
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      Reveal.initialize({
        history: true,
        controls: false,
        transition: "none",
        viewDistance: 2,
        help: false,
        dependencies: [{
            src: 'plugin/notes/notes.js',
            async: true
          },
          {
            src: 'plugin/highlight/highlight.js',
            async: true,
            callback: function() {
              hljs.initHighlightingOnLoad();
            }
          }
        ]});
    </script>
  </body>
</html>
